// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                   String   @id @default(cuid())
  phoneNumber          String   @unique
  fullName             String
  email                String?
  address              String
  profilePictureUrl    String?
  role                 UserRole @default(USER)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  lastLoginAt          DateTime?
  isActive             Boolean  @default(true)
  totalCasesFiled      Int      @default(0)
  
  // Relations
  cases                Case[]
  notifications        Notification[]
  reviewedCases        Case[]   @relation("CaseReviewer")
  
  @@map("users")
}

model Case {
  id                       String   @id @default(cuid())
  userId                   String
  status                   CaseStatus @default(PENDING)
  
  // Patient Info
  patientName              String
  patientAge               Int
  patientGender            Gender
  relationshipToPatient    String
  
  // Hospital Info
  hospitalName             String
  hospitalAddress          String
  hospitalState            String
  hospitalRegistrationNo   String?
  department               String
  
  // Timeline
  admissionDate            DateTime
  dischargeDate            DateTime?
  isDischarged             Boolean  @default(false)
  
  // Complaint
  detailedDescription      String
  voiceRecordingUrl        String?
  voiceRecordingDuration   Int?
  
  // Relations
  issueCategories          CaseIssueCategory[]
  
  // Location
  gpsLatitude              Float?
  gpsLongitude             Float?
  capturedAddress          String?
  
  // Attachments
  attachments              Attachment[]
  
  // Metadata
  submittedAt              DateTime @default(now())
  reviewedAt               DateTime?
  reviewedBy               String?
  adminComments            String?
  rejectionReason          String?
  resolvedAt               DateTime?
  viewCount                Int      @default(0)
  
  // Privacy
  isPublic                 Boolean  @default(false)
  
  // Relations
  user                     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviewer                 User?    @relation("CaseReviewer", fields: [reviewedBy], references: [id])
  notifications            Notification[]
  
  @@map("cases")
}

model Attachment {
  id           String   @id @default(cuid())
  caseId       String
  fileName     String
  fileUrl      String
  fileType     String
  fileSize     Int
  uploadedAt   DateTime @default(now())
  
  // Relations
  case         Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)
  
  @@map("attachments")
}

model Notification {
  id             String           @id @default(cuid())
  userId         String
  title          String
  message        String
  type           NotificationType
  relatedCaseId  String?
  isRead         Boolean          @default(false)
  createdAt      DateTime         @default(now())
  
  // Relations
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  relatedCase    Case?            @relation(fields: [relatedCaseId], references: [id], onDelete: SetNull)
  
  @@map("notifications")
}

model CaseIssueCategory {
  id         String    @id @default(cuid())
  caseId     String
  category   String
  
  // Relations
  case       Case      @relation(fields: [caseId], references: [id], onDelete: Cascade)
  
  @@map("case_issue_categories")
}

model Hospital {
  id                   String   @id @default(cuid())
  name                 String
  address              String
  state                String
  registrationNumber   String?
  addedBy              String
  addedAt              DateTime @default(now())
  
  @@map("hospitals")
}

enum UserRole {
  USER
  ADMIN
  SUPERADMIN
}

enum CaseStatus {
  PENDING
  APPROVED
  REJECTED
  RESOLVED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum NotificationType {
  CASE_SUBMITTED
  CASE_APPROVED
  CASE_REJECTED
  CASE_RESOLVED
  ADMIN_ALERT
}